<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="groups/all"></ion-back-button>
        </ion-buttons>
        <ion-title *ngIf="groupId">
            {{'editGroup.headerEdit' | translate}}
        </ion-title>
        <ion-title *ngIf="!groupId">
            {{'editGroup.headerCreate' | translate}}
        </ion-title>
    </ion-toolbar>
</ion-header>

<ion-content padding #content>
    <form [formGroup]="groupForm">
        <ion-list>
            <ion-list-header>
                {{'editGroup.details' | translate}}
            </ion-list-header>
            <ion-item>
                <ion-label position="floating">{{'editGroup.name' | translate}}</ion-label>
                <ion-input
                        autocomplete="off"
                        type="text"
                        formControlName="name"
                        maxlength="25"
                        placeholder="{{'editGroup.groupNamePlaceholder' | translate}}"
                        autofocus
                        required></ion-input>
            </ion-item>
            <ion-item>
                <ion-label position="floating">{{'editGroup.icon' | translate}}</ion-label>
                <ion-icon slot="start"
                          *ngIf="groupForm.value"
                          [name]="groupForm.value.icon"></ion-icon>
                <ion-select formControlName="icon">
                    <ion-select-option
                            *ngFor="let option of iconOptions"
                            [value]="option">
                        <ion-icon [name]="option">{{
                            option
                            }}</ion-icon>
                    </ion-select-option>
                </ion-select>
            </ion-item>

        </ion-list>
        <ion-list>
            <ion-list-header>
                {{'editGroup.members' | translate}} ({{members.controls?.length}})
            </ion-list-header>
            <ion-item-divider sticky color="light">
                <ion-item lines="none" color="light">
                    <ion-label position="stacked">{{'editGroup.addMember' | translate}}</ion-label>
                    <ion-input
                        #memberInput
                        placeholder="{{'editGroup.addMemberPlaceholder' | translate}}"
                        name="newMember"
                        (keyup.enter)="addMember()"
                        [(ngModel)]="newMemberName"
                        [ngModelOptions]="{ standalone: true }"
                        autocomplete="off"></ion-input>
                    <ion-button
                            type="button"
                            (click)="addMember()"
                            slot="end"
                            [disabled]="!addMemberValid()">
                        <ion-icon name="add" slot="icon-only"></ion-icon>
                    </ion-button>
                </ion-item>
            </ion-item-divider>
            <app-missing-data-text
                    [data]="members.controls"
                    text="{{'editGroup.noMembers' | translate}}">
            </app-missing-data-text>
            <app-member
                    [name]="member.value"
                    *ngFor="let member of members.controls; let i = index">
                <ion-button color="danger" (click)="removeMember(member.value)">
                    <ion-icon name="trash" slot="icon-only"></ion-icon>
                </ion-button>
            </app-member>
        </ion-list>
    </form>
</ion-content>

<ion-footer>
    <ion-toolbar>
        <ion-button
                type="submit"
                color="primary"
                expand="full"
                [disabled]="!groupForm.valid"
                (click)="groupForm.valid && onSubmit()">
            <ion-icon name="save" slot="start"></ion-icon>
            {{'editGroup.save' | translate}}
        </ion-button>
    </ion-toolbar>
</ion-footer>
